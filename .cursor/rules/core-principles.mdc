---
alwaysApply: true
description: å¤šAIå¯¹è¯èšåˆå™¨é¡¹ç›®çš„æ ¸å¿ƒåŸåˆ™å’Œæ¶æ„è®¾è®¡
---

# å¤šAIå¯¹è¯èšåˆå™¨ - æ ¸å¿ƒåŸåˆ™

## é¡¹ç›®æ¦‚è¿°
Chromeæµè§ˆå™¨æ‰©å±•ï¼Œå…è®¸ç”¨æˆ·ä»å·²æ‰“å¼€çš„æ ‡ç­¾é¡µä¸­é€‰æ‹©ç½‘ç«™è¿›è¡Œåˆ†å±æ˜¾ç¤ºï¼Œå¹¶æ”¯æŒç»Ÿä¸€è¾“å…¥åŠŸèƒ½ã€‚

## ğŸš¨ æ ¸å¿ƒåŸåˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

### 1. ç»å¯¹ç¦æ­¢ç¡¬ç¼–ç 
- âŒ ç¦æ­¢åœ¨ä»»ä½•åœ°æ–¹ç¡¬ç¼–ç ç½‘ç«™åˆ—è¡¨ã€åŸŸåã€URL
- âŒ ç¦æ­¢åœ¨[manifest.json](mdc:manifest.json)ä¸­ç¡¬ç¼–ç content_scriptsçš„matchesï¼ˆä½¿ç”¨`<all_urls>`ï¼‰
- âŒ ç¦æ­¢åœ¨ä»£ç ä¸­ç¡¬ç¼–ç é€‰æ‹©å™¨
- âœ… ä¸€åˆ‡é…ç½®ä»ç”¨æˆ·é€‰æ‹©æˆ–å­˜å‚¨ä¸­åŠ¨æ€è¯»å–
- âœ… æ”¯æŒç”¨æˆ·æ·»åŠ ä»»æ„ç½‘ç«™

### 2. å®Œå…¨åŠ¨æ€åŒ–
- ç½‘ç«™åˆ—è¡¨ï¼šä»å·²æ‰“å¼€çš„æ ‡ç­¾é¡µåŠ¨æ€è·å–
- é€‰æ‹©å™¨ï¼šç”¨æˆ·é€šè¿‡å¯è§†åŒ–å·¥å…·é…ç½®
- Content Scriptsï¼šä½¿ç”¨`<all_urls>`æ³¨å…¥åˆ°æ‰€æœ‰é¡µé¢
- åŠŸèƒ½ï¼šè‡ªåŠ¨é€‚é…ç”¨æˆ·é€‰æ‹©çš„ä»»ä½•ç½‘ç«™

## æ ¸å¿ƒæ¶æ„

### ä¸»è¦ç»„ä»¶
- **tab-selector**: ä»å·²æ‰“å¼€æ ‡ç­¾é¡µé€‰æ‹©è¦åˆ†å±çš„ç½‘ç«™ [tab-selector.js](mdc:tab-selector/tab-selector.js)
- **split-view**: ä½¿ç”¨iframeåœ¨ä¸€ä¸ªæ ‡ç­¾é¡µå†…åˆ†å±æ˜¾ç¤ºå¤šä¸ªç½‘ç«™ [split-view.js](mdc:split-view/split-view.js)
- **selector-config**: å¯è§†åŒ–é…ç½®AIç½‘ç«™çš„è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®é€‰æ‹©å™¨ [selector-config.js](mdc:selector-config/selector-config.js)
- **window-manager**: å¤‡ç”¨æ–¹æ¡ˆï¼Œä½¿ç”¨çª—å£APIæ’åˆ— [window-manager.js](mdc:window-manager/window-manager.js)
- **element-picker**: æ³¨å…¥åˆ°ç›®æ ‡ç½‘ç«™çš„å…ƒç´ é€‰æ‹©å·¥å…· [element-picker.js](mdc:selector-config/element-picker.js)

### å…³é”®æŠ€æœ¯
- **declarativeNetRequest API**: ç§»é™¤X-Frame-Optionsé™åˆ¶ï¼Œå®ç°iframeåµŒå…¥ï¼ˆè§[rules.json](mdc:rules.json)ï¼‰
- **postMessage**: è·¨iframeé€šä¿¡ï¼Œå®ç°ç»Ÿä¸€å‘é€
- **chrome.storage.local/sync**: æ•°æ®æŒä¹…åŒ–
- **chrome.tabs API**: è·å–å’Œç®¡ç†æ ‡ç­¾é¡µ
- **Content Scripts**: æ“ä½œç½‘é¡µDOMï¼ˆè§[iframe-injector.js](mdc:content-scripts/iframe-injector.js)ï¼‰

## é‡è¦è®¾è®¡å†³ç­–

### 1. å®Œå…¨ç§»é™¤ç¡¬ç¼–ç 

âŒ **é”™è¯¯åšæ³•**ï¼šé¢„è®¾AIç½‘ç«™åˆ—è¡¨
```javascript
const DEFAULT_AI_SITES = [
  { id: 'chatgpt', name: 'ChatGPT', url: 'https://chatgpt.com/' },
  { id: 'gemini', name: 'Gemini', url: 'https://gemini.google.com/' }
];
```

âœ… **æ­£ç¡®åšæ³•**ï¼šä»æ ‡ç­¾é¡µåŠ¨æ€è·å–
```javascript
const tabs = await chrome.tabs.query({});
const validTabs = tabs.filter(tab => 
  tab.url && tab.url.startsWith('http') && 
  !tab.url.includes('chrome://')
);
```

### 2. æ•°æ®ä¼ é€’æœºåˆ¶

**tab-selector â†’ split-view**:
```javascript
// tab-selectorä¿å­˜ä¸´æ—¶æ•°æ®
await chrome.storage.local.set({ 
  selectedSitesForSplit: sites,
  splitViewTimestamp: Date.now()
});

// split-viewè¯»å–ï¼ˆ5ç§’å†…æœ‰æ•ˆï¼‰
if (localResult.selectedSitesForSplit && 
    Date.now() - localResult.splitViewTimestamp < 5000) {
  aiSites = localResult.selectedSitesForSplit;
}
```

### 3. è·¨iframeé€šä¿¡

**çˆ¶é¡µé¢å‘é€** (åœ¨[split-view.js](mdc:split-view/split-view.js)ä¸­):
```javascript
iframe.contentWindow.postMessage({
  action: 'fillAndSend',
  text: text,
  source: 'ai-aggregator'
}, '*');
```

**iframeå†…éƒ¨æ¥æ”¶** (åœ¨[iframe-injector.js](mdc:content-scripts/iframe-injector.js)ä¸­):
```javascript
window.addEventListener('message', (event) => {
  if (event.data.action === 'fillAndSend' && 
      event.data.source === 'ai-aggregator') {
    fillInput(element, event.data.text);
    clickSendButton();
  }
});
```

## æ³¨æ„äº‹é¡¹

1. **ä¸è¦ç¡¬ç¼–ç **ï¼šä»»ä½•ç½‘ç«™åˆ—è¡¨éƒ½åº”è¯¥åŠ¨æ€ç”Ÿæˆ
2. **äº‹ä»¶é˜»æ­¢è¦å½»åº•**ï¼šmousedown/mouseup/clickéƒ½è¦é˜»æ­¢
3. **è·¨iframeé€šä¿¡è¦éªŒè¯æ¥æº**ï¼šæ£€æŸ¥sourceæ ‡è¯†
4. **æ•°æ®ä¼ é€’è¦åŠ æ—¶é—´æˆ³**ï¼šé˜²æ­¢è„æ•°æ®
5. **ç©ºçŠ¶æ€è¦å‹å¥½**ï¼šå¼•å¯¼ç”¨æˆ·è€Œéæ˜¾ç¤ºç©ºç™½
6. **è°ƒè¯•æ—¥å¿—è¦è¯¦ç»†**ï¼šå…³é”®è·¯å¾„å¿…é¡»æœ‰æ—¥å¿—
7. **ç”¨æˆ·æ“ä½œè¦æœ‰åé¦ˆ**ï¼šåŠ è½½ä¸­/æˆåŠŸ/å¤±è´¥éƒ½è¦æç¤º
