# 修复发送按钮选错问题 - 图文教程

## 问题现象

**症状**：每次发送消息，侧边栏会打开/关闭
**原因**：发送按钮选择器选错了，选到了侧边栏切换按钮

## 为什么会选错？

你配置的发送按钮选择器是：`span.mat-mdc-button-touch-target`

这是 **Material Design** 的通用触摸区域选择器，页面上有很多按钮都用这个class：
- ✅ 发送按钮有
- ❌ 侧边栏切换按钮也有
- ❌ 其他功能按钮也有

所以选择器匹配到了错误的按钮！

## 快速修复方案

### 方案1: 使用脚本快速修复（推荐）

#### 步骤1: 打开分屏页面的控制台
1. 在分屏页面按 `F12` 打开开发者工具
2. 切换到 `Console` 标签

#### 步骤2: 运行修复脚本
将 `快速修复发送按钮.js` 的内容复制粘贴到控制台，然后运行：
```javascript
await quickFix()
```

这会自动修复：
- ✅ Gemini: 改为 `button[aria-label*="Send"]`
- ✅ ChatGPT: 改为 `button[data-testid="send-button"]`

#### 步骤3: 修复千问
1. **右键点击千问的iframe** → 选择"检查"（会打开iframe的控制台）
2. 在iframe控制台粘贴 `快速修复发送按钮.js`
3. 运行：
```javascript
diagnoseQwen()
```

4. 查看输出，找到正确的发送按钮（通常是靠近输入框的submit按钮）

5. 复制建议的选择器，运行：
```javascript
await updateQwenConfig('button[type="submit"]')  // 使用找到的选择器
```

#### 步骤4: 刷新测试
刷新分屏页面，重新测试发送。

### 方案2: 重新配置（手动）

#### 步骤1: 删除错误的配置
1. 打开"选择器配置向导"
2. 在"已配置的AI网站"列表中，点击千问和Gemini的 🗑️ 删除按钮

#### 步骤2: 重新配置千问
1. 在千问页面，先手动输入一些文字（让发送按钮出现）
2. 打开"选择器配置向导" → 选择千问 → "打开并标记"
3. **选择输入框**：点击输入文字的大框
4. **选择发送按钮**：
   - ⚠️ **不要点击侧边栏按钮**
   - ✅ **点击输入框右下角/旁边的紫色箭头按钮**
   - 或者找带有"发送"图标的按钮
5. 保存配置

#### 步骤3: 重新配置Gemini
1. 在Gemini页面，先手动输入一些文字
2. 打开"选择器配置向导" → 选择Gemini → "打开并标记"
3. **选择输入框**：点击"Ask Gemini"输入区域
4. **选择发送按钮**：
   - ✅ **点击输入框右下角的发送箭头**
   - ⚠️ 不要点击侧边栏、菜单等其他按钮
5. 保存配置

## 如何避免选错？

### 识别发送按钮的特征

#### ✅ 正确的发送按钮：
1. **位置**：通常在输入框的右下角或旁边
2. **图标**：通常有箭头、飞机、发送等图标
3. **行为**：输入框为空时通常是禁用(disabled)状态
4. **颜色**：通常是品牌色（紫色、蓝色等）

#### ❌ 错误的按钮：
1. **侧边栏按钮**：通常在页面边缘
2. **菜单按钮**：通常有三条横线图标
3. **关闭按钮**：通常有X图标
4. **工具按钮**：通常在工具栏

### 选择器配置技巧

#### 好的选择器特征：
1. **有submit类型**：`button[type="submit"]`
2. **有发送语义**：`button[aria-label*="Send"]`
3. **有测试ID**：`button[data-testid="send-button"]`
4. **类名包含send**：`button[class*="send"]`

#### 避免的选择器：
1. ❌ `span.mat-mdc-button-touch-target` - 太通用
2. ❌ `button.mat-button` - 太通用
3. ❌ 只有样式类的选择器 - 会匹配很多按钮

## 稳定的选择器推荐

### Gemini
```css
button[aria-label*="Send"]
```
**为什么稳定？** aria-label是无障碍属性，Google遵循Web标准，不会轻易改。

### ChatGPT
```css
button[data-testid="send-button"]
```
**为什么稳定？** data-testid是测试用的ID，OpenAI的测试代码依赖它，不会轻易改。

### Qwen
```css
button[type="submit"]
```
**为什么稳定？** type="submit"是HTML标准，表单提交按钮的语义化属性。

## 验证配置是否正确

### 在iframe控制台测试：

```javascript
// 1. 测试输入框选择器
const input = document.querySelector('你配置的输入框选择器');
console.log('输入框:', input);

// 2. 测试发送按钮选择器
const btn = document.querySelector('你配置的发送按钮选择器');
console.log('发送按钮:', btn);
console.log('按钮文本/aria-label:', btn.textContent, btn.getAttribute('aria-label'));
console.log('按钮位置:', btn.getBoundingClientRect());

// 3. 模拟填充和点击
input.focus();
input.value = '测试';
input.dispatchEvent(new Event('input', {bubbles: true}));

// 等待2秒后点击（检查侧边栏是否会动）
setTimeout(() => {
  console.log('准备点击按钮...');
  btn.click();
  console.log('已点击！如果侧边栏没动，说明配置正确！');
}, 2000);
```

## 常见问题

### Q1: 为什么选择器配置向导也会选错？
**A**: 配置向导只能记录你点击的元素，如果你点击了错误的按钮，它就会记录错误的选择器。关键是要**认准正确的发送按钮**再点击。

### Q2: 有没有办法自动识别发送按钮？
**A**: 有！我已经在代码中添加了智能识别逻辑：
- 优先使用配置的选择器
- 配置失效时，按稳定性尝试通用选择器
- 最后兜底：查找输入框附近的submit按钮

但是如果用户配置了错误的选择器，系统会优先使用错误的配置。

### Q3: 为什么不直接禁用错误的按钮？
**A**: 我们不知道哪个按钮是"错误的"，只能通过选择器去找。所以关键是**配置正确的选择器**。

## 立即行动

1. **打开分屏页面控制台**
2. **运行 `await quickFix()`**
3. **在千问iframe运行 `diagnoseQwen()`**
4. **刷新分屏页面测试**

如果还是不行，请截图发送按钮的HTML结构，我帮你分析。

---

最后更新：2025-10-17
关键词：发送按钮、选择器配置、侧边栏误触

