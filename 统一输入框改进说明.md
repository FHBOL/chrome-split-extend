# 📝 统一输入框改进说明

## 🎯 本次改进的问题

### 问题1：配置发送按钮时，按钮不显示
**场景**：某些AI网站（如Claude、ChatGPT等）在输入框为空时不显示发送按钮，导致用户在配置选择器时无法选择到发送按钮。

### 问题2：统一发送框用户体验问题
1. **发送后内容不清除**：每次发送后，输入框内容保留，需要手动删除
2. **回车不发送**：需要点击按钮才能发送，不够便捷
3. **无法换行**：没有换行功能，输入长文本不方便

## ✅ 解决方案

### 1. 自动填充测试文字显示发送按钮

**改进位置**：`selector-config/element-picker.js`

**实现方式**：
- 当用户选择输入框后，自动填充测试文字："测试文字（请选择发送按钮）"
- 触发网站的输入事件，让发送按钮显示出来
- 延迟500ms执行，确保页面响应

**代码逻辑**：
```javascript
// 选择输入框后
isPickingInput = false;
showHint('✅ 输入框已选择！正在填充测试文字以显示发送按钮...', 'success');

// 自动填充测试文字
setTimeout(() => {
  fillTestText(element);
}, 500);

// 填充函数
function fillTestText(element) {
  const testText = '测试文字（请选择发送按钮）';
  
  if (element.tagName === 'TEXTAREA' || element.tagName === 'INPUT') {
    element.value = testText;
    element.dispatchEvent(new Event('input', { bubbles: true }));
    element.dispatchEvent(new Event('change', { bubbles: true }));
  } else if (element.isContentEditable || element.getAttribute('contenteditable') === 'true') {
    element.textContent = testText;
    element.innerHTML = testText;
    element.dispatchEvent(new Event('input', { bubbles: true }));
    element.dispatchEvent(new Event('change', { bubbles: true }));
  }
  
  element.focus();
  showHint('📝 已填充测试文字，现在可以看到发送按钮了！请选择发送按钮', 'info');
}
```

### 2. 优化统一输入框交互

**改进位置**：`split-view/split-view.js`、`split-view/split-view.html`、`split-view/split-view.css`

#### 2.1 Enter发送，Ctrl+Enter换行

**修改前**：
- 需要点击按钮发送
- Ctrl+Enter发送

**修改后**：
- **Enter键直接发送**（更符合聊天习惯）
- **Ctrl+Enter或Shift+Enter换行**（输入长文本）

**实现代码**：
```javascript
// split-view/split-view.js
document.getElementById('unifiedInput').addEventListener('keydown', (e) => {
  // Enter发送，Ctrl+Enter换行
  if (e.key === 'Enter' && !e.ctrlKey && !e.shiftKey) {
    e.preventDefault();
    sendToAllAI();
  }
  // Ctrl+Enter或Shift+Enter换行（默认行为）
});
```

#### 2.2 发送后自动清空输入框

**修改前**：发送后内容保留，需要手动删除

**修改后**：发送成功后0.5秒自动清空，方便连续提问

**实现代码**：
```javascript
// split-view/split-view.js (在sendToAllAI函数末尾)
// 发送成功后清空输入框
setTimeout(() => {
  document.getElementById('unifiedInput').value = '';
}, 500);
```

#### 2.3 优化输入框样式

**改进内容**：
- 增加最小高度 `min-height: 24px`
- 增加行高 `line-height: 1.5`
- 调整最大高度为 `120px`（支持更多行）

**CSS代码**：
```css
#unifiedInput {
  flex: 1;
  background: transparent;
  border: none;
  color: white;
  font-size: 14px;
  resize: none;
  outline: none;
  max-height: 120px;
  min-height: 24px;
  font-family: inherit;
  line-height: 1.5;
}
```

#### 2.4 更新提示文字和按钮标题

**HTML更新**：
```html
<textarea 
  id="unifiedInput" 
  placeholder="在这里输入问题，按Enter发送（Ctrl+Enter换行）..."
  rows="1"
></textarea>
<button id="sendButton" class="send-btn" title="发送到所有AI (Enter)">
  ⚡ 发送
</button>
```

## 🎉 用户体验提升

### 配置选择器时
1. ✅ 选择输入框后，**自动填充测试文字**
2. ✅ 发送按钮**自动显示**，可以直接选择
3. ✅ 提示信息清晰，引导用户操作

### 使用统一输入框时
1. ✅ **Enter键直接发送**，无需点击按钮
2. ✅ **Ctrl+Enter换行**，支持输入长文本
3. ✅ **发送后自动清空**，方便连续提问
4. ✅ 更好的输入框高度和行高，支持多行显示

## 🔧 如何测试

### 测试1：配置选择器
1. 打开插件，点击"🎯 配置AI选择器"
2. 选择任意AI网站（如Claude）
3. 点击"选择输入框元素"
4. 在新标签页中点击输入框
5. **观察**：输入框自动填充"测试文字（请选择发送按钮）"
6. **观察**：发送按钮显示出来
7. 点击发送按钮完成配置

### 测试2：统一输入框
1. 打开"🌐 分屏视图"
2. 在统一输入框中输入问题
3. **测试Enter发送**：按Enter键，消息发送到所有AI
4. **观察**：0.5秒后输入框自动清空
5. **测试换行**：输入文字，按Ctrl+Enter或Shift+Enter，光标换行
6. **测试多行输入**：输入多行文字，观察输入框高度自动调整

## 📌 注意事项

1. **自动填充测试文字**仅在配置选择器时触发，不会影响正常使用
2. **清空输入框**延迟0.5秒，给用户足够时间看到发送状态
3. **Enter发送**符合大多数聊天工具的习惯，但可以通过Ctrl+Enter换行
4. **输入框最大高度120px**，超过会出现滚动条

## 🚀 后续可能的优化

- [ ] 支持自定义快捷键
- [ ] 支持保存发送历史
- [ ] 支持输入框大小调整
- [ ] 支持markdown语法高亮
- [ ] 支持@提及特定AI（只发送给指定AI）

